 <html> <!--Simulates the card game 'Memory' using photos-->
	<head>
		<script src="http://code.jquery.com/jquery-1.7.1.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.marionette/1.0.0-rc6-bundled/backbone.marionette.min.js"></script>
		<!--<link rel="stylesheet" href="style.css" type="text/css">-->
		<script> 
		$(function(){
		var Card = Backbone.Model.extend({ ///////////////////////////////////////////////ModelClass
			defaults: {
				is_flipped: false,
				img: null,
				index: null
			}
		});
		
		var Board = Backbone.Collection.extend({    //////////////////////////////////////CollectionClass
			model: Card,
			/*shuffle: function(){
				var tempSlot;
				var randomNumber = Math.floor(Math.random() * this.length);
				this.model.set({index, randomNumber});
			}*/
		});
		
		/* imageClicked: function(e){
		 * 	e.preventDefault();
		 * var id = $(e.currentTarget).data("id"); ---in the template anchor he added data-id="${id}" html5
		 */
		
		//ImageGallery.vent = _.extend({}, Backbone.Events);
		
		var CardView = Backbone.Marionette.ItemView.extend({  //////////////////////////////ItemView
			template: "#card-tmpl",
			templateHelpers: {
				
				getCardImage: function() {
					if(!this.is_flipped) {
						return "images/card.jpg";
					} else {
						return this.img;
					}
				}
			},
			className: "card",
			events: {
				"click": "flipCard"
			},
			flipCard: function(){
				App.vent.trigger("card:flip", this.model);
				var is_flipped = this.model.get("is_flipped");
				var which_card = this.model.get("img");
				console.log(which_card);
				this.model.set({is_flipped: !is_flipped});
				this.render();
			}
		});
		
		
		var BoardView = Backbone.Marionette.CollectionView.extend({ //////////////////////CollectionView
			itemView: CardView,
			initialize: function(Board){
				App.vent.on("card:flip", function(Card){
					console.log("flipping");
					console.log(face_up);
				});
			}
			
			/*comparator: function(Card){
				return Card.get("index");
			},
			
			onSuccess: function (){
				this.collection.sort();
			}*/
			
		});
		
		
		var TheBoard = new Board();/////////////////////////////////////////////////////////NewCollection
		
		
		var face_up = TheBoard.where({is_flipped: "false"});
		console.log(face_up.length);
		
		
		var App = new Backbone.Marionette.Application();////////////////////////////////////NewApp
		
		
		App.addRegions({ ///////////////////////////////////////////////////////////////////addRegion
			board: '#container'
		});
		
		
		App.addInitializer(function(){//////////////////////////////////////////////////////addInitializer
			_.each(_.range(8), function(i){
				var card = new Card({////////////////////////////////////////////////////////NewModel
					img: "images/album/" + i + ".jpg"
				});
				var duplicate = card.clone();
				TheBoard.push(card);
				TheBoard.push(duplicate);
			});
			TheBoard.shuffle(); ////////////////////////////I haven't defined the shuffle() function yet. It would go in BoardView
			var this_board_view = new BoardView({
				collection: TheBoard
			});
			console.log(App);
			App.board.show(this_board_view);
		});
		
		
		App.start();///////////////////////////////////////////////////////////////////////////Start
		});
		
		</script>
	<script type="text/html" id="card-tmpl">
		<div><img src="<%= getCardImage() %>" style="width: 100px; height: 150px"></div>
		
	</script>
	</head>
	
	<div id="body">
		<div id="container">
		
				<div id="refresh" ><input type="submit" value="Refresh" id="Refresh_button"></input></div>
		</div>
		
	</div>
	
	
	
</html>
